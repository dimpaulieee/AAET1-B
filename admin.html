<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="assets/styles.css">
</head>
<body>
<div class="container">
  <h1>Admin Dashboard</h1>
  <form id="addReviewerForm" class="card">
    <input type="text" id="reviewerName" placeholder="Name" required>
    <input type="text" id="reviewerSubject" placeholder="Subject" required>
    <input type="text" id="reviewerLink" placeholder="Link (optional)">
    <label><input type="checkbox" id="reviewerFeatured"> Featured</label>
    <button type="submit">Add Reviewer</button>
  </form>

  <h2>Current Reviewers</h2>
  <table id="reviewersTable">
    <thead>
      <tr><th>Name</th><th>Subject</th><th>Featured</th><th>Link</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
import { db, auth } from './js/firebase.js';
import { collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const form = document.getElementById('addReviewerForm');
const tableBody = document.querySelector('#reviewersTable tbody');

async function loadReviewers() {
  tableBody.innerHTML = '';
  const snapshot = await getDocs(collection(db, 'reviewers'));
  snapshot.forEach((docSnap) => {
    const data = docSnap.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${data.name}</td>
      <td>${data.subject}</td>
      <td>${data.featured ? 'âœ…' : ''}</td>
      <td>${data.link ? `<a href="${data.link}" target="_blank">Link</a>` : ''}</td>
      <td>
        <button class="deleteBtn">Delete</button>
        <button class="toggleFeaturedBtn">${data.featured ? 'Unfeature' : 'Feature'}</button>
      </td>
    `;
    tableBody.appendChild(tr);

    // Delete
    tr.querySelector('.deleteBtn').addEventListener('click', async () => {
      await deleteDoc(doc(db, 'reviewers', docSnap.id));
      loadReviewers();
    });

    // Toggle Featured
    tr.querySelector('.toggleFeaturedBtn').addEventListener('click', async () => {
      await updateDoc(doc(db, 'reviewers', docSnap.id), { featured: !data.featured });
      loadReviewers();
    });
  });
}

// Add reviewer
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = document.getElementById('reviewerName').value;
  const subject = document.getElementById('reviewerSubject').value;
  const link = document.getElementById('reviewerLink').value;
  const featured = document.getElementById('reviewerFeatured').checked;

  await addDoc(collection(db, 'reviewers'), {
    name, subject, link: link || "", featured, addedBy: auth.currentUser.uid, createdAt: new Date().toISOString()
  });
  form.reset();
  loadReviewers();
});

loadReviewers();
</script>
</body>
</html>
