<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AAET 1-B | Login</title>
<link rel="stylesheet" href="assets/styles.css">
</head>
<body>

<!-- Background and overlay -->
<div class="intro-bg">
  <div class="overlay">
    <div class="intro-container">

      <!-- Section Name & Motto -->
      <h1 class="fadeIn">AAET 1-B</h1>
      <p class="fadeIn delay1">Excellence, Unity, and Growth</p>

      <!-- Intro Images -->
      <div class="intro-visuals fadeIn delay2">
        <img src="assets/section1.jpg" alt="AAET 1-B Photo 1">
        <img src="assets/section2.jpg" alt="AAET 1-B Photo 2">
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="login-form fadeIn delay3">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>
        <p id="msg" class="login-msg"></p>
      </form>

    </div>
  </div>
</div>

<script type="module">
import { auth, db } from './js/firebase.js';
import { signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const loginForm = document.getElementById('loginForm');
const msg = document.getElementById('msg');

loginForm.addEventListener('submit', async (e)=>{
  e.preventDefault();

  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  try {
    const userCred = await signInWithEmailAndPassword(auth, email, password);
    const user = userCred.user;

    // Get role from Firestore
    const docRef = doc(db,'users',user.uid);
    const snap = await getDoc(docRef);

    if(!snap.exists()){
      msg.innerText = "No role assigned to this account.";
      return;
    }

    const role = snap.data().role;

    if(role === 'admin'){
      window.location.href = 'admin.html';
    } else {
      window.location.href = 'student.html';
    }

  } catch(error){
    msg.innerText = error.message;
  }
});
</script>

</body>
</html>
